<div class="mainCont">
  <div class="sidePanel">
    <button class="sidePanelBtn" id="fontP">font+</button>
    <button class="sidePanelBtn" id="color">kolory</button>
    <button class="sidePanelBtn" id="fontM">font-</button>
    <button class="sidePanelBtn" id="save">zapisz ustawienia</button>
    <button class="sidePanelBtn" id="changeName">zmiana nazwy</button>

   

  </div>
  <div class="centerPanel">

    <div id="label">{{name}}</div>
  <textarea id='lineCounter' wrap='off' class="color-blue-line" readonly>1.</textarea>
  <textarea id='codeEditor' wrap='off' class="color-blue-editor">{{content}}</textarea>   
    </div>
  </div>
</div>
<dialog id="changeNameDialog">
  <p>Nazwa Pliku</p>
  <form action="/changeFileName" method="get">
    <input type="text" name="name" />
    <button type="submit">Dodaj</button>
  </form>

</dialog>

<script>
  document.getElementById('changeName').addEventListener('click', (e) => {
  document.getElementById('changeNameDialog').showModal() })
const classes={'color-blue':['color-blue-editor','color-blue-line'],'color-violet':['color-violet-editor','color-violet-line'],'color-grey':['color-grey-editor','color-grey-line'],'color-contrast':['color-contrast-editor','color-contrast-line']}

const codeEditor = document.getElementById('codeEditor');
const lineCounter = document.getElementById('lineCounter');
codeEditor.addEventListener('keydown', (e) => {
       let { keyCode } = e;
       let { value, selectionStart, selectionEnd } = codeEditor;
if (keyCode === 9) {  
         e.preventDefault();
         codeEditor.value = value.slice(0, selectionStart) + '\t' + value.slice(selectionEnd);
         codeEditor.setSelectionRange(selectionStart+2, selectionStart+2)
       }
 });
 let lineCountCache = 0;
 
function line_counter() {
      let lineCount = codeEditor.value.split('\n').length;
      let outarr = new Array();
      if (lineCountCache != lineCount) {
         for (let x = 0; x < lineCount; x++) {
            outarr[x] = (x + 1) + '.';
         }
         lineCounter.value = outarr.join('\n');
      }
      lineCountCache = lineCount;
}
codeEditor.addEventListener('input', () => {
    line_counter();
});
async function getConfig() {
  let res = await fetch('/getConfig');
   const config=await res.json()
   return config
}
getConfig().then(data=>{
  const index=classes[data.theme]
  const [editorClass,lineClass]=index
  console.log(editorClass,lineClass)
  })


</script>